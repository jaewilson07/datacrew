{"file_path": "../../raw_kb_v2\\article\\360042923114\\index.html", "content": {"Title": "Creating a Rolling Average Using DataFlows", "Article Body": "Intro\n                       \n\n                        You can create a rolling average for a specified number of days\u00a0using\u00a0a SQL DataFlow or\u00a0Magic ETL. To do this, you will need to\u00a0join the data back onto itself multiple times.\n                       \n\n                        Solution Details and Steps\n                       \n\n                        MySQL\n                       \n\n\n\n                          Create a\u00a0MySQL DataFlow.\n                         \n\n\n\n                          Add your input DataSet.\n                         \n\n\n\n                          Create a transform using the following query:\n                         \n\n\n\n\n                         SELECT\u00a0a.`value`,(SELECT AVG(b.`value`) FROM input_DataSet b\u00a0WHERE b.`date` <= a.`date` AND b.`date` >= SUBDATE(a.`date`, INTERVAL 5 DAY)\u00a0) AS \u2018Rolling 5 Day\u00a0Average\u2019\u00a0,a.`date`\u00a0FROM input_DataSet\n                        \n\n\n\n\n                          (Optional) If you would like to change the day comparison (changing 5 day average to 7 days), you can change the number in your SUBDATE() [SUBDATE(a.`date`, INTERVAL 5 DAY)].\n                         \n\n\n\n                          If you would like to do a rolling sum or another calculation you can change your AVG() to the proper aggregation. [SELECT AVG(b.`value`) FROM input_DataSet b ].\n                         \n\n\n\n                          You will need to change `date` to your date column.\n                         \n\n\n\n                          You will need to change `value` to your value column.\n                         \n\n\n\n                          Create an output to the DataFlow. The query should be\u00a0SELECT * FROM transform_data_1.\n                         \n\n\n\n                          Name the output and your DataFlow.\n                          \n\n\n\n\n\n\n                        RedShift\n                       \n\n\n\n                          Create a\u00a0RedShift DataFlow.\n                         \n\n\n\n                          Add your input DataSet.\n                         \n\n\n\n                          Create a transform using the following query:\n                         \n\n\n\n\n                         SELECT\u00a0a.\u201dvalue\u201d,(SELECT AVG(b.\u201dvalue\u201d) FROM input_DataSet b\u00a0WHERE b.\u201ddate\u201d <= a.\u201ddate\u201d AND b.\u201ddate\u201d >= DATEADD(DAY, -5, a.\u201ddate\u201d) ) AS \u201cRolling 5 Day Average\u201d,a.\u201ddate\u201d\u00a0FROM input_DataSet\n                        \n\n\n\n\n                          If you would like to change the day comparison (changing 5 day average to 7 days), you can change the number in your DATEADD() [DATEADD(DAY, -5, a.\u201ddate\u201d)].\n                         \n\n\n\n                          If you would like to do a rolling sum or another calculation you can change your AVG() to the proper aggregation. [SELECT AVG (b.\u201dvalue\u201d) FROM input_DataSet b ].\n                         \n\n\n\n                          You will need to change \u201cdate\u201d to your date column.\n                         \n\n\n\n                          You will need to change \u201cvalue\u201d to your value column.\n                         \n\n\n\n                          Create an output to the DataFlow. The query should be\u00a0SELECT * FROM transform_data_1.\n                         \n\n\n\n                          Name the output and your DataFlow.\n                         \n\n\n\n\n\n\n                        Magic ETL\n                       \n\n\n\n                          Create a new Magic ETL.\n                         \n\n\n\n                          Add \u201cInput DataSet\u201d tile.\n                         \n\n\n\n                          Add \u201cSelect Columns\u201d tile.\u00a0Select only your date and value columns.\n                         \n\n\n\n                          You are going to create a \u201cDate Operations\u201d tile for every day you wish to compare.\u00a0If you are showing 5 day average you will need to create 5 tiles.\n                         \n\n\n\n                          You will select for all of these to use your \u201cSelect Columns\u201d tile as their input.\n                          \n\n\n\n\n\n\n                          Your \u201cDate Operations\u201d tiles will be adding a day to your original date column. Your first tile will add 1 day, your second will add 2 and this will continue.\n                          \n\n\n\n\n\n\n                          You now want to add 5 different \u201cJoin Data\u201d tiles.\n                          \n\n\n\n\n\n\n                          Your joins are going to pull from the previous join and your date operation.\n                         \n\n\n\n                          The join should be formatted with your previous join (original data) as your left table. Your right table will be your \u201cDate Operations.\"\n                         \n\n\n\n                          You should join on the original \u201cDate\u201d = \u201cDate + _.\"\n                          \n\n\n\n\n\n\n                          Your data should now look like the following screenshot if you \u201cRun Preview.\u201d\n                          \n\n\n\n\n\n\n                          You can use a \u201cSelect Columns\u201d to pull your original \u201cDate\u201d and \u201cValue\u201d columns. You will also pull all other value columns. (Value_1 \u2013 Value_5)\n                          \n\n\n\n\n\n\n                          You can now start to add your values together to create your average.\n                         \n\n\n\n                          You will need to add all of your value columns together.\n                         \n\n\n\n                          Using the \u201cCalculator\u201d tile we can add two columns together at a time.\n                          \n\n\n\n\n\n\n                          You now can divide by the number of value columns you\u00a0have, using the \u201ccalculator\u201d tile. In this example it is 6.\n                          \n\n\n\n\n\n\n                          You\u00a0can now clean up your columns using the \u201cSelect Columns\u201d tile.\n                         \n\n\n\n                          You only need to keep your \u201cDate\u201d, \u201cValue\u201d, and \u201cRolling Average\u201d columns.\n                          \n\n\n\n\n\n\n                          Your data should now look similar to:\n                          \n\n\n\n\n\n                          You can now add an output to your Magic ETL.", "Preview Article": "Click here to preview", "URL Name": "360042923114", "Summary\n                     \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n                       Briefly describe the article. The summary is used in search results to help users find relevant articles. You can improve the accuracy of search results by including phrases that your customers use to describe this issue or topic.": "", "Article Number": "000004617", "Archived Date": "", "Language": "English", "Primary Version": "Creating a Rolling Average Using DataFlows", "Article Total View Count": "5,369", "": "", "Article Created Date": "10/24/2022, 10:17 PM", "First Published Date": "10/24/2022, 10:41 PM"}, "title": "\n              Creating a Rolling Average Using DataFlows\n             ", "breadcrumbs": [{"text": "\n\n               Domo\n              \n", "url": "/s/knowledge-base/"}, {"text": "\n\n               Transforming Data In Domo\n              \n", "url": "/s/topic/0TO5w000000ZamzGAC"}, {"text": "\n\n               Transformation Tips And Tricks\n              \n", "url": "/s/topic/0TO5w000000ZaoJGAS"}]}