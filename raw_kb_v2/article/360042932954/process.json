{"file_path": "../../raw_kb_v2\\article\\360042932954\\index.html", "content": {"title": "\n\n\n Writing Amazon Kinesis Data to Domo\n\n\n", "article_body": "\n\nIntro\n-------\n\nYou can write the data being pushed to your Amazon Kinesis Stream into a Domo DataSet, using an Amazon Lambda function and a Domo JSON Webhook\u00a0DataSet.\n\nPrerequisites\n---------------\n\nTo write data from a Kinesis Stream to Domo, you will need the following:\n\n a Kinesis Stream receiving data in JSON format, with one JSON object per Kinesis record\n* an active Domo instance\n\nStep 1 \u2013 Create a JSON Webhook DataSet\n----------------------------------------\n\nData pushed to Kinesis will be copied into a JSON Webhook dataset.\u00a0Follow these instructions to create this DataSet:\n\n. In the Domo Appstore,\u00a0find and click on the JSON Webhook connector.\n2. Click\n **Get the Data**\n .\n3. Copy and save the link in the\n **Webhook URL**\n field. (Note that you cannot change this field.)\n4. (Optional) If you want a secret credential to be required for the Webhook when data is sent to it, enter it into\u00a0the\n **Webhook Secret**\n field. (For\u00a0the remainder of these steps,\u00a0we will assume a Webhook Secret is not being used.)\n5. Select whether the DataSet will Append or Replace. It is set to Append by default, which is typically what Kinesis users need.\n6. Click\n **Next**\n .\n7. Name your DataSet and click\n **Save**\n .\n\nYour DataSet will appear to run, but there won\u2019t be any data in it. It will only contain\u00a0data after JSON data is sent to the Webhook URL. The system will automatically check for any new data every 15 minutes. Selecting\n **Run DataSet**\n will not speed up the process.\n\n\n Step 2 \u2013 Create an Amazon Lambda Function\n-------------------------------------------\n\nTo get data from the Kinesis Stream into the Webhook, you will use an Amazon Lambda function. This is a small JavaScript function which will be called whenever new data is pushed to your Kinesis Stream. The function will consolidate all the new Kinesis records into a single JSON array and send that data to the Webhook. Each record will become a single row in the Domo DataSet.\n\n\n Follow these instructions to create the Lambda Function:\n\n. In the AWS Management Console, choose the Lambda service. (Note that your AWS UI may be slightly different.)\n2. In the menu on the left, choose\n **Functions**\n .\n3. Click\n **Create function**\n .\n4. Fill out the fields to author the function from scratch:\n\n* Name \u2013 Give your function a descriptive, memorable name.\n\t* Runtime \u2013 Select the language your function will use. This tutorial uses Node.js 8.10. Note that it is also possible to create functions using Java, C#, Go, Python, or Ruby.\n\t* Role \u2013 Select\n\t **Choose an existing role**\n\t . Work with your AWS administrator to make sure that there is a role appropriate for this function. The role needs to be able to read from Kinesis, write to CloudWatch (for logging), and make HTTPS calls.\n5. Click\n **Create function**\n .\n6. After the Lambda function has been created, add Kinesis as a trigger to it by selecting\n **Kinesis**\n from the menu on the left of the screen.\n7. Configure the trigger by filling out the required fields. Generally, the default values are acceptable:\n\n* Kinesis stream \u2013 Select the Stream that you want to use to trigger this function. This is the stream that is getting the data you want to copy to Domo.\n\t* Consumer \u2013 Leave this as\n\t **No consumer**\n\t .\n\t* Batch Size \u2013 You can adjust this based on how much data your Kinesis Stream has to handle. To start, leave it at 100.\n\t* Starting Position \u2013 Set this to\n\t **Latest**\n\t . That way, the function will be given the most recent data in the Kinesis Stream.\n\t* Enable Trigger \u2013 Make sure this box is checked.\n8. Click\n **Add**\n .\n9. Click the name of the Function so that the Function Code panel appears.\n10. Set the code fields to the following:\n\n* Code entry type \u2013 Edit code inline\n\t* Runtime \u2013 Node.js 8.10\n\t* Handler \u2013 index.handler\n11. The code window should show a file called\n\nindex.js\n\n. Replace all of the code in that file with the following:\n\n\n`/**\n\n\n * Stream data from AWS Kinesis to Domo via Webhook\n\n\n */`\n\n\n`'use strict';`\n\n\n`const https = require('https');`\n\n\n`// This is called when the Lambda function is triggered.\n\n\n // It should be configured to be triggered by data in a Kinesis Stream\n\n\n exports.handler = (event, context, callback) => {\n\n\n let count = 0;`\n\n\n`// Build an array of all of the JSON objects that came in from Kinesis\n\n\n let collectedData = [];\n\n\n event.Records.forEach((record) => {\n\n\n // Kinesis data is base64 encoded so decode here\n\n\n const data = new Buffer(record.kinesis.data, 'base64').toString('ascii');\n\n\n // console.log('Decoded payload:', JSON.stringify(data, null, 2));\n\n\n console.log('Decoded payload:', data);`\n\n\n`// Assumes that each Kinesis record contains only 1 JSON object\n\n\n let item = JSON.parse(data);\n\n\n collectedData[count] = item;`\n\n\n`count += 1;\n\n\n });`\n\n\n`// The array of objects will be passed to the webhook in a single POST call\n\n\n let postData = JSON.stringify(collectedData);\n\n\n let options = {\n\n\n host: process.env.WEBHOOK_HOST, // Should generally be \"\n\nwebhooks.demo.domo.com\n\n\"\n\n\n path: process.env.WEBHOOK_ENDPOINT, // Should be the rest of the webhook URL given by Domo\n\n\n method: 'POST',\n\n\n headers: {\n\n\n 'Content-Type': 'application/json',\n\n\n 'Content-Length': postData.length\n\n\n }\n\n\n };`\n\n\n`const req = https.request(options, (res) => {\n\n\n console.log('statusCode: ' + res.statusCode);`\n\n\n`res.on('data', (d) => {\n\n\n console.log('data: ' + d);\n\n\n })`\n\n\n`});`\n\n\n`req.on('error', (e) => {\n\n\n console.error('*** ERROR ***');\n\n\n console.error(e);\n\n\n });`\n\n\n`req.write(postData);`\n\n\n`req.end();`\n\n\n`console.log('Pushed ' + count + ' record(s) to the webhook');\n\n\n };`\n12. Below the code window, add two environment variables:\n\n* WEBHOOK\\_HOST\n\n \u2013 This should be the domain in the Webhook URL given in the DataSet you created in step 1 of these instructions. It will typically be\n\n\n\t webhooks.domo.com\n\n\n\t .\n\t* WEBHOOK\\_ENDPOINT\n\n \u2013 This should be everything in the Webhook URL starting with \u201c\n\n /streams\n\n \u201d. This will be a very long alphanumeric string of characters.\n13. From the menu in the editor, select\n **File --> Save**\n .\n14. At the top of the screen, click\n **Save**\n to save all changes to your Lambda function.\n\nNow, whenever data is pushed into your Kinesis Stream, this Lambda function will run. The function will take the individual Kinesis records, combine them into a single JSON array, and pass that JSON array to the Webhook dataset via an HTTPS POST call. This will copy your data into Domo.\n\n", "preview_article": "\n\nClick here to preview\n\n", "url_name": "\n\n\n 360042932954\n\n\n", "summary____________________________________________briefly_describe_the_article_the_summary_is_used_in_search_results_to_help_users_find_relevant_articles_you_can_improve_the_accuracy_of_search_results_by_including_phrases_that_your_customers_use_to_describe_this_issue_or_topic": "\n\n", "article_number": "\n\n\n 000003158\n\n\n", "archived_date": "\n\n\n", "language": "\n\n\n English\n\n\n", "primary_version": "\n\nWriting Amazon Kinesis Data to Domo\n\n", "article_total_view_count": "\n\n\n 2,461\n\n\n", "": "\n\n", "article_created_date": "\n\n\n 10/24/2022, 9:10 PM\n\n\n", "first_published_date": "\n\n\n 10/24/2022, 10:41 PM\n\n\n"}, "title": "writing_amazon_kinesis_data_to_domo", "breadcrumbs": [{"text": "domo", "url": "/s/knowledge-base/"}, {"text": "connecting_data_to_domo", "url": "/s/topic/0TO5w000000ZammGAC"}, {"text": "other_connection_methods", "url": "/s/topic/0TO5w000000ZanzGAC"}]}