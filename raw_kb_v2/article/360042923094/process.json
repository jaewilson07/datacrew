{"file_path": "../../raw_kb_v2\\article\\360042923094\\index.html", "content": {"title": "\n\n\n Creating a Rolling Average Period-over-Period DataFlow\n\n\n", "article_body": "\n\nAt times you may want to create a card with, for example, a three-month moving average for this year compared to the same period last year, to see if they are trending up or down in comparison to the previous year.\n\n\n To create the DataFlow for this calculation, create a transform like:\n\n\n`SELECT\n\n\n `DateField`\n\n\n ,`ValueField`\n\n\n ,(SELECT\n\n\n SUM(`ValueField`) / COUNT(*)\n\n\n FROM\n\n\n TABLE\u00a0t2\n\n\n WHERE\n\n\n t2.`DateField` > LAST_DAY(DATE_SUB(t1.`DateField`, INTERVAL 3 MONTH))\n\n\n AND t2.`DateField` < LAST_DAY(t1.`DateField`) ) AS `Rolling_Average``\n\n\n`FROM\n\n\n TABLE\u00a0t1`\n\n\n This transform assumes that the \"DateField\" column contains a date representing the month, e.g.\n\n2015-01-01\n\nfor January.\n\n\n The subquery retrieves the sum of the last 3 months\u2019 worth of values and then divides them by the number of records found in the range, creating the \"Rolling\\_Average\" field.\n\n\n You need to replace your field names for \u201cDateField\" and \u201cValueField\u201d and add any others you want in the resulting DataSet. Also replace\n\nTABLE\n\nwith the DataSet table you\u2019re using as your input.\n\n\n It is often beneficial to create a snapshot of values, so that as of any date chosen, you can look at that day\u2019s values compared against other time periods (the day before, week before, month before, etc.). To do this in a DataFlow, the data must be placed side-by-side so the card can read it properly. The following example query does this. Each section should be its own transform. You should also add indexing to the query for MySQL DataFlows.\n\n\n`Select\n\n\n today.date,\n\n\n today.value,\n\n\n yesterday.value,\n\n\n lastweek.value,\n\n\n lastmonth.value\n\n\n from\n\n\n rawdata today\n\n\n left join\n\n\n (select date_add(datevalue, INTERVAL 1 DAY) as date, value from rawdata) yesterday\n\n\n on today.date = yesterday.date\n\n\n left join\n\n\n (select date_add(datevalue, INTERVAL 7 DAY) as date, value from rawdata) lastweek\n\n\n on today.date = lastweek.date\n\n\n left join\n\n\n (select date_add(datevalue, INTERVAL 1 MONTH) as date, value from rawdata) lastmonth\n\n\n on today.date = lastmonth.date`\n\n\n The following table shows the logic behind this query:\n\nSome additional work may be needed in order to pull in the correct columns and values (such as using a Group By action).\n\n", "preview_article": "\n\nClick here to preview\n\n", "url_name": "\n\n\n 360042923094\n\n\n", "summary____________________________________________briefly_describe_the_article_the_summary_is_used_in_search_results_to_help_users_find_relevant_articles_you_can_improve_the_accuracy_of_search_results_by_including_phrases_that_your_customers_use_to_describe_this_issue_or_topic": "\n\n", "article_number": "\n\n\n 000004619\n\n\n", "archived_date": "\n\n\n", "language": "\n\n\n English\n\n\n", "primary_version": "\n\nCreating a Rolling Average Period-over-Period DataFlow\n\n", "article_total_view_count": "\n\n\n 4,941\n\n\n", "": "\n\n", "article_created_date": "\n\n\n 10/24/2022, 10:17 PM\n\n\n", "first_published_date": "\n\n\n 10/24/2022, 10:39 PM\n\n\n"}, "title": "creating_a_rolling_average_periodoverperiod_dataflow", "breadcrumbs": [{"text": "domo", "url": "/s/knowledge-base/"}, {"text": "transforming_data_in_domo", "url": "/s/topic/0TO5w000000ZamzGAC"}, {"text": "transformation_tips_and_tricks", "url": "/s/topic/0TO5w000000ZaoJGAS"}]}